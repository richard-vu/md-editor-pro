"use strict";(()=>{(function(){"use strict";let g=acquireVsCodeApi();window.vscodeApi=g;let e,d,v,m,l,p,E,h=300;function b(){return e?{start:e.selectionStart,end:e.selectionEnd,text:e.value.substring(e.selectionStart,e.selectionEnd)}:{start:0,end:0,text:""}}function T(t,n=0,r=0){if(!e){console.error("Editor not initialized");return}let o=e.selectionStart,a=e.selectionEnd,s=e.value.substring(0,o),i=e.value.substring(a),c=e.scrollTop;e.value=s+t+i,e.focus();let u=o+t.length+n,f=o+t.length+r;e.setSelectionRange(u,f),e.scrollTop=c,e.dispatchEvent(new Event("input"))}function L(t){if(!e){console.error("Editor not initialized");return}let n=e.selectionStart,r=e.selectionEnd,o=e.value.substring(0,n),a=e.value.substring(r),s=e.scrollTop;e.value=o+t+a,e.focus();let i=n+t.length;e.setSelectionRange(i,i),e.scrollTop=s,e.dispatchEvent(new Event("input"))}function S(t,n,r){if(!e){console.error("Editor not initialized");return}let o=e.selectionStart,a=e.selectionEnd,s=e.value.substring(0,o),i=e.value.substring(a),c=e.scrollTop,u=t+r+n;e.value=s+u+i,e.focus();let f=o+t.length,C=f+r.length;e.setSelectionRange(f,C),e.scrollTop=c,e.dispatchEvent(new Event("input"))}function k(t){if(!e){console.error("Editor not initialized");return}let n=e.selectionStart,r=e.selectionEnd,o=e.value.substring(0,n),a=e.value.substring(r),s=e.scrollTop;e.value=o+t+a,e.focus();let i=n+t.length;e.setSelectionRange(i,i),e.scrollTop=s,e.dispatchEvent(new Event("input"))}window.editorAPI={getSelection:b,insertText:T,replaceSelection:L,insertTemplate:S,insertAtCursor:k,getValue:()=>e?e.value:"",focus:()=>e?e.focus():void 0};function w(){e=document.getElementById("markdown-editor"),d=document.getElementById("preview-content"),v=document.getElementById("resizer"),m=document.getElementById("editor-pane"),l=document.getElementById("preview-pane");let t=document.body.classList.contains("fullscreen-mode");if(!e||!m){console.error("Required DOM elements not found (editor or editor-pane missing)");return}if(!t&&(!d||!v||!l)){console.error("Required DOM elements not found for split view mode");return}if(typeof window.markdownit<"u"?p=window.markdownit({html:!0,linkify:!0,typographer:!0,breaks:!0}):console.error("markdown-it not loaded"),typeof window.mermaid<"u"){let n=document.body.classList.contains("theme-dark")?"dark":"default";window.mermaid.initialize({startOnLoad:!1,theme:n,securityLevel:"loose"})}M(),g.postMessage({type:"ready"})}function M(){e&&(e.addEventListener("input",A),l&&e.addEventListener("scroll",x),v&&P(),window.addEventListener("message",H),e.addEventListener("keydown",z))}function A(){e&&(clearTimeout(E),E=window.setTimeout(()=>{let t=e.value;g.postMessage({type:"edit",content:t}),d&&y(t)},h))}function x(){if(!e||!l)return;let t=e.scrollTop/(e.scrollHeight-e.clientHeight);!isNaN(t)&&isFinite(t)&&(l.scrollTop=t*(l.scrollHeight-l.clientHeight))}function H(t){let n=t.data;switch(n.type){case"update":e&&(e.value=n.content,d&&y(n.content));break;case"theme-changed":D(n.kind);break}}function y(t){if(d){if(!p){d.innerHTML='<div class="loading">Loading Markdown renderer...</div>';return}try{let n=p.render(t);if(d.innerHTML=n,typeof window.mermaid<"u"){d.querySelectorAll("code.language-mermaid").forEach((o,a)=>{let s=o.textContent||"",i=`mermaid-diagram-${a}-${Date.now()}`,c=document.createElement("div");c.className="mermaid",c.id=i,c.textContent=s;let u=o.parentElement;u&&u.tagName==="PRE"&&u.replaceWith(c)});try{window.mermaid.init(void 0,".mermaid")}catch(o){console.error("Mermaid rendering error:",o)}}d.querySelectorAll("a").forEach(r=>{r.addEventListener("click",o=>{o.preventDefault(),g.postMessage({type:"openLink",url:r.href})})})}catch(n){console.error("Preview render error:",n),d.innerHTML=`<div class="loading" style="color: var(--vscode-errorForeground);">
                Error rendering preview: ${n.message}
            </div>`}}}function D(t){if(!e)return;let r=t===1||t===3?"dark":"light";document.body.className=`theme-${r}`,typeof window.mermaid<"u"&&(window.mermaid.initialize({startOnLoad:!1,theme:r,securityLevel:"loose"}),y(e.value))}function P(){if(!v||!m||!l)return;let t=!1,n=0,r=0;v.addEventListener("mousedown",o=>{t=!0,n=o.clientX,r=m.offsetWidth,document.body.style.cursor="col-resize",document.body.style.userSelect="none",o.preventDefault()}),document.addEventListener("mousemove",o=>{if(!t||!m||!l)return;let a=o.clientX-n,s=r+a,i=m.parentElement.offsetWidth,c=i*.2,u=i*.8;if(s>=c&&s<=u){let f=s/i*100;m.style.flex=`0 0 ${f}%`,l.style.flex=`0 0 ${100-f}%`}}),document.addEventListener("mouseup",()=>{t&&(t=!1,document.body.style.cursor="",document.body.style.userSelect="")})}function z(t){let n=window.toolbarActions;(t.ctrlKey||t.metaKey)&&t.key==="b"&&(t.preventDefault(),n?.bold()),(t.ctrlKey||t.metaKey)&&t.key==="i"&&(t.preventDefault(),n?.italic()),(t.ctrlKey||t.metaKey)&&t.key==="k"&&(t.preventDefault(),n?.link())}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",w):w()})();})();
